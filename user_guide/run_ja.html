
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>slack_transfer.run の使い方 &#8212; slack_transfer 0.1.5 documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API reference" href="../reference/index.html" />
    <link rel="prev" title="環境構築" href="environment_ja.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">slack_transfer 0.1.5 documentation</p>
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index_ja.html">
  ユーザーガイド
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../reference/index.html">
  API reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="environment_ja.html">
   環境構築
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   slack_transfer.run の使い方
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="cli.html">
   CLI
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   0. 全体像と用語定義
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   1. 注意事項
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#slack-download">
   2. slackトークンの取得(download側)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#slack-upload">
   3. slackトークンの取得(upload側)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   4. チャンネル名のマッピングの検討
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#uploadwsprivateapi-bot">
   5. Upload側WSのPrivateチャンネルにAPI botの追加
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   6.
   <code class="code docutils literal notranslate">
    <span class="pre">
     slack_transfer.run
    </span>
   </code>
   の実行
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      
    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="slack-transfer-run">
<h1>slack_transfer.run の使い方<a class="headerlink" href="#slack-transfer-run" title="Permalink to this heading">#</a></h1>
<p><a class="reference internal" href="environment_ja.html"><span class="doc">環境構築</span></a> のステップが完了している前提で説明します．</p>
<section id="id1">
<h2>0. 全体像と用語定義<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p><code class="code docutils literal notranslate"><span class="pre">slack_transfer.run</span></code> を用いることで，移行元のSlack workspaceから移行先のSlack workspaceにデータを移行することができます．</p>
<dl class="simple">
<dt>まず，ここでは以下のように用語を定義します．</dt><dd><ul class="simple">
<li><p>WS: slack workspaceのことを意味します．</p></li>
<li><p>OrG: Slack OrGのことを意味します．Enterprise gridの契約をしている場合のみに適用され，多くの場合，意識する必要はありませんが，このレポジトリの特記事項などにおいてEnter prise grid配下のWSの場合の注意事項がある場合があります．</p></li>
<li><p>download側: ここでは，移行元のWSを指します．データをこのWSからdownloadすることからdownload側と呼びます．</p></li>
<li><p>upload側：ここでは，移行先のWSを指します．データをこのWSにuploadすることからupload側と呼びます．</p></li>
<li><p>端末: <a class="reference internal" href="environment_ja.html"><span class="doc">環境構築</span></a> で環境構築</p></li>
</ul>
</dd>
</dl>
<p>このレポジトリでは，同じWSでもdownload側とupload側を間違えてしまうと，大事故の原因なので，明示的に分離を行っており，tokenの権限なども役割に合わせて，read/writeを使い分けるなどして，事故が起きないようにします．</p>
<p><code class="code docutils literal notranslate"><span class="pre">slack_transfer.run</span></code> は基本的に移行作業をall-in-oneで実施します．
さまざまな対策はしているとはいえ，slackサーバーの挙動や，子のレポジトリに存在する潜在的なバグにより，一発で成功しない場合もあることは，あらかじめご承知おきください．
<code class="code docutils literal notranslate"><span class="pre">slack_transfer.run</span></code> が実施する作業は以下です．</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>┌────────────┐                ┌────────────┐              ┌────────────┐
│download側WS│  --download-&gt;  │    端末    │  --upload-&gt;  │ Upload側WS │
└────────────┘                └────────────┘              └────────────┘
</pre></div>
</div>
<p>そのため，端末に，download側WSのデータを保存するのに充分なディスク容量が必要です．
一般的に，大きい容量を必要とするものではありませんが，download側WSの添付ファイルなども端末にダウンロードするため，添付ファイルのサイズと量次第では，大きな容量を必要とする場合があります．
フリープランを使用していれば，5GBを超える場合にアップロード時に警告が出ていると思われます．
他にも，事前に容量を確認できる機能を実装する予定はあります．</p>
</section>
<section id="id2">
<h2>1. 注意事項<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h2>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>移植といっても，完全な移植はできません．できる限り多くを移植できるようには努めていますが，一部Slack APIの仕様上できないものがあります．現時点で対応していないものは以下です．</dt><dd><ul>
<li><p>Slack connectの移植 (Slack connectは，connect元につなぎなおしを依頼してください)</p></li>
<li><p>Bookmarkの移植におけるフォルダー分けの維持 (Slack APIの設計上不可能)</p></li>
<li><p>Slack postを移植した場合に，フォーマット崩れする可能性があることと，readonlyで移植される (Slack　APIの設計上不可能)</p></li>
<li><p>reactionの移植 (APIではbotがreactionのemojiを押すことしかできないので，)</p></li>
<li><p>3000文字を越える投稿におけるフォーマット崩れの可能性 (APIの制限のため，分割投稿となるから．)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>メッセージの移植はAPIによる代理投稿として行われるので，タイムスタンプは移植時の物に変わります．代わりに，投稿者名の末尾にオリジナルのタイムスタンプを付与しています．</p></li>
<li><p>MITライセンスで提供されており，なんら保証はありません．</p></li>
<li><p>Channelしか移植できません．DMは移植できません．</p></li>
</ul>
</div></blockquote>
<p>なお，このツールは，できる限り，破壊的操作を行わないように設計されています．</p>
<dl class="simple">
<dt>Download側WSで実施されうる変更：</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>このツールで使用するSlack botがすべてのPublic channelに意図せず自ら自動参加をする</dt><dd><ul>
<li><p>token_test時には，general相当のデフォルトチャンネルに自動で自ら参加します．</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Download側でユーザーが行わなければいけない作業:</dt><dd><ul class="simple">
<li><p>このツールを用いて移植したいprivate channelにたいして，このツールで使用するbotを追加する</p></li>
</ul>
</dd>
<dt>Upload側WSで実施される変更：</dt><dd><ul class="simple">
<li><p>チャンネルの作成を含む，ファイルアップロード，bookmarkの追加，メッセージの投稿，ピンの作成などの新規追加作業</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--override</span></code> フラグを使用した場合に，既存のチャンネルに対して，ファイルやbookmark，メッセージの追加，チャンネルの説明と目的の変更，pinの追加など．</p></li>
</ul>
</dd>
<dt>Upload側でユーザーが行わなければいけない作業(=このツールが実施しないこと):</dt><dd><ul class="simple">
<li><p>不要チャンネルの削除</p></li>
<li><p>データ移行に失敗した場合に，再度実施する際のチャンネルを削除する操作 (<code class="code docutils literal notranslate"><span class="pre">--override</span></code> フラグを使う選択肢もありますが，二重にデータが入り得ります)</p></li>
<li><p>移行完了後に，public channelから希望に応じてprivate channelに変える操作</p></li>
<li><p>希望に応じて他人をチャンネルに追加する操作</p></li>
</ul>
</dd>
</dl>
</section>
<section id="slack-download">
<h2>2. slackトークンの取得(download側)<a class="headerlink" href="#slack-download" title="Permalink to this heading">#</a></h2>
<p>Download側に必要になるScopeは以下です．</p>
<dl class="simple">
<dt>【Downloader/Uploader共通で必要】</dt><dd><ul class="simple">
<li><p>channels:history</p></li>
<li><p>channels:join</p></li>
<li><p>channels:read</p></li>
<li><p>files:read</p></li>
<li><p>groups:history</p></li>
<li><p>groups:read</p></li>
</ul>
</dd>
<dt>【Downloaderに必要】</dt><dd><ul class="simple">
<li><p>bookmarks:read</p></li>
<li><p>users:read</p></li>
</ul>
</dd>
</dl>
</section>
<section id="slack-upload">
<h2>3. slackトークンの取得(upload側)<a class="headerlink" href="#slack-upload" title="Permalink to this heading">#</a></h2>
<p>Upload側に必要になるScopeは以下です．</p>
<dl class="simple">
<dt>【Downloader/Uploader共通で必要】</dt><dd><ul class="simple">
<li><p>channels:history</p></li>
<li><p>channels:join</p></li>
<li><p>channels:read</p></li>
<li><p>files:read</p></li>
<li><p>groups:history</p></li>
<li><p>groups:read</p></li>
</ul>
</dd>
<dt>【Uploaderに必要】</dt><dd><ul class="simple">
<li><p>channels:manage</p></li>
<li><p>files:write</p></li>
<li><p>chat:write</p></li>
<li><p>pins:write</p></li>
<li><p>bookmarks:write</p></li>
</ul>
</dd>
</dl>
</section>
<section id="id3">
<h2>4. チャンネル名のマッピングの検討<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>generalチャンネル(あるいはそれを改称した場合も)は，特別な取扱いをされ，privateへの変更ができないだけでなく，Slack connectができません．
そのため，Upload側WSのgeneralチャンネルにデータを流し込むことには慎重になるべきです．</p>
<p>一般に，download側WSのgeneralチャンネルをupload側WSのgeneralチャンネルにデータ移行することはお勧めしません．</p>
<dl class="simple">
<dt>それ以外にも，すでにupload側WSにチャンネル名の重複が存在する場合には，以下の3つの選択肢があります．</dt><dd><ul class="simple">
<li><p>そのままこれまでの投稿の末尾に追加する → 特に追加の作業不要</p></li>
<li><p>一旦まっさらにして，新規で作りたい → 先にチャンネルを削除(アーカイブとして残したい場合はチャンネル名を変更してからアーカイブ)</p></li>
<li><p>別チャンネルとして新しく作りたい → チャンネルマッピングを設定します．後述の引数で設定します．</p></li>
</ul>
</dd>
</dl>
<p>これらの基準に基づき，マッピングを行うチャンネルを選定して，旧チャンネルに対応する新チャンネルのマッピングを決めてください．</p>
</section>
<section id="uploadwsprivateapi-bot">
<h2>5. Upload側WSのPrivateチャンネルにAPI botの追加<a class="headerlink" href="#uploadwsprivateapi-bot" title="Permalink to this heading">#</a></h2>
</section>
<section id="id4">
<h2>6. <code class="code docutils literal notranslate"><span class="pre">slack_transfer.run</span></code> の実行<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>ここまで準備したら，いよいよデータの移行を開始します．</p>
<dl class="simple">
<dt>大体の時間の目安としては，メッセージ数をMとすると，</dt><dd><ul class="simple">
<li><p>ダウンロードが 3M/100 秒 + ファイルのダウンロード時間</p></li>
<li><p>アップロードが M 秒 + ファイルのアップロード時間</p></li>
</ul>
</dd>
</dl>
<p>くらいのオーダーで，アップロード時には特に時間がかかるとと思った方が良いです．
これは，Slack APIのlimitもありますので，CLIを使用して並列化をすることなどはあまりお勧めしません．</p>
<p>Mが充分に大きい場合には，作業を行う端末が長時間にわたって稼働できるときに作業をおこなうことをお勧めします．
なお，CLIを使った個別の移行も可能にする予定ですので，そちらもご検討ください．</p>
<p>では，実際に移行の作業に入ります．</p>
<p>まず，venvを使用する場合にはvenvに入ります．</p>
<p>Mac/Linux/WSLの場合</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ . .venv/bin/activate
</pre></div>
</div>
<p>Windowsの場合</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ . .venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</pre></div>
</div>
<p>そのうえで，</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ slack_transfer　run --data_dir<span class="o">=</span>&lt;local_data_dir&gt; --downloader_token<span class="o">=</span>&lt;downloader_token&gt; --uploader_token<span class="o">=</span>&lt;uploader_token&gt; --channel_names<span class="o">=</span>&lt;channel_names&gt; --name_mappings<span class="o">=</span>&lt;name_mappings&gt; <span class="o">[</span>--override<span class="o">]</span> <span class="o">[</span>--skip_bookmarks<span class="o">]</span>
</pre></div>
</div>
<p>などと実行します．
<code class="code docutils literal notranslate"><span class="pre">slack_transfer</span></code> が実行できない場合には，代わりに <code class="code docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">slack_transfer.run</span></code> を使用することもできます．</p>
<dl class="simple">
<dt>それぞれのパラメータは以下の通りです．</dt><dd><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;local_data_dir&gt;</span></code>: ダウンロードしたデータを端末内に一時保存するディレクトリです．相対ディレクトリ，絶対ディレクトリのどちらでも設定できます．存在しない場合は自動生成されます．わからなければ， <code class="code docutils literal notranslate"><span class="pre">local_data_dir</span></code> などと設定してください．</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;downloader_token&gt;</span></code>: 2で取得したdownload側WSのAPI tokenです． xoxb-から始まります．</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;uploader_token&gt;</span></code>: 3で取得したupload側WSのAPI tokenです． xoxb-から始まります．</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;channel_names&gt;</span></code>: 処理の対象にしたいチャンネル名を指定します．カンマ区切りで，Download側WSの名前で指定します．指定せず，すべてを対象にする場合は，:code:<a href="#id5"><span class="problematic" id="id6">`</span></a>–channel_names=&lt;channel_names&gt;`を丸ごと削除します．</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;name_mappings&gt;</span></code>: 4で決めたチャンネル名のマッピングを設定します．不要な場合は <code class="code docutils literal notranslate"><span class="pre">--name_mappings=&lt;name_mappings&gt;</span></code> を丸っと削除してください．なお，設定方法は <code class="code docutils literal notranslate"><span class="pre">old_name1:new_name1,old_name2:new_name2</span></code> などと設定します．old_nameがdownload側，new_nameがupload側のチャンネル名で，マッピングが必要なものだけを記載すれば充分です．(そのままの名前でよい場合は設定不用意)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--override</span></code>: 4で「そのままこれまでの投稿の末尾に追加する」を選択した場合には，これを付与してください．不要な場合は削除します．</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">--skip_bookmarks</span></code>: bookmarkの移植を行わない場合に使用するフラグです．bookmarkも移植する場合は削除します．</p></li>
</ul>
</dd>
</dl>
<p>それ以外の詳細な引数に関しては，
<a class="reference internal" href="../reference/generated/other/slack_transfer.run.run.html"><span class="doc">slack_transfer.run.run</span></a> を参照してください．</p>
<p>これらを総合すると，実行すべきコマンド例は以下のような形になります．</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ slack_transfer　run --data_dir<span class="o">=</span>local_data_dir --downloader_token<span class="o">=</span>xoxb-00000000000-0000000000000-xxxxxxxxxxxxxxxxxxxxxxxx --uploader_token<span class="o">=</span>xoxb-0000000000000-0000000000000-xxxxxxxxxxxxxxxxxxxxxxxx --override --name_mappings<span class="o">=</span>general:_general,random:_random
</pre></div>
</div>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="environment_ja.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">環境構築</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../reference/index.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">API reference</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>

<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2022, Masanori HIRANO.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>
  </div>
  
</div>
</footer>
  </body>
</html>